{% load humanize %}

<div id="viz-categories" class="viz"></div>
<div id="chart">
  <div style="height: 4px;"></div>
  <div style="height: 8px;"></div>
  <div style="height: 15px;"></div>
  <div style="height: 16px;"></div>
  <div style="height: 23px;"></div>
  <div style="height: 42px;"></div>
</div>
<script>
d3.select('#chart')
  .selectAll("div")
  .data([4, 8, 15, 16, 23, 42])
  .enter()
  .append("div")
  .style("height", (d)=> d + "px")

  var category = "{{category}}"
  var title = (category == "Mimetype") ? "Files by {{category}}"  : "Datasets by {{category}}";

  var dataset_counts_by_category = [
    {% for i in dataset_counts_by_category %}
        {"value":{{ i.count }},  "weight": {{ i.percent_number }}, "type": "{{ i.category }}", "label":"{{ i.category}} ({{ i.percent_string }})"}
        {%if not forloop.last%},{%endif%}
    {%endfor%}
    ]

      // instantiate d3plus
      var visualization = d3plus.viz()
        .container("#viz-categories")     // container DIV to hold the visualization
        .data(dataset_counts_by_category)     // data to use with the visualization
        .type("tree_map")       // visualization type
        .id("type")            // nesting keys
        .text("label")
        .size("value")      // sizing of blocks
        .color("weight")
        .legend(false)
        .title(title)         // key name to size bubbles
        .draw()                // finally, draw the visualization

</script>
